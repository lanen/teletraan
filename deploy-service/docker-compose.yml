version: '2'
services:
  deploy-service:
    build: ./teletraanservice
    ports:
      - "8080:8080"
      - "8081:8081"
    command: "/opt/deploy-service/teletraanservice/bin/run.sh -c /opt/deploy-service/teletraanservice/bin/server.yaml"
    environment:
      - TELETRAAN_DB_HOST=deploy-mysql
      - TELETRAAN_DB_POST=3306
      - TELETRAAN_DB_USER=evan
      - TELETRAAN_DB_PASSWORD=dev
      - TELETRAAN_DASHBOARD_URL=http://localhost:8888
    volumes: 
      - ".:/opt/deploy-service"
      - "./log:/tmp/teletraan/"
    extra_hosts:
      board.oa.com: 192.168.90.150
      deploy.oa.com: 192.168.90.150
  deploy-mysql:
    image: mysql:5.5
    ports:
      - "3306:3306"
    container_name: "deploy-mysql"
    volumes:
      - "/tmp/.data/deploydb:/var/lib/mysql"
      - "./common/src/main/resources/sql:/var/teletraan/sql"
      - "../tools/mysql:/var/teletraan/tools"
    environment:
      MYSQL_ROOT_PASSWORD: ""
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
